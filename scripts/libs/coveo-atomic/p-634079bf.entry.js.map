{"version":3,"names":["atomicSmartSnippetAnswerCss","AtomicSmartSnippetAnswer","this","isRendering","componentWillRender","componentDidRender","emitCurrentHeight","componentDidLoad","setTimeout","host","classList","add","connectedCallback","wrapperElement","resizeObserver","observe","disconnectedCallback","_a","disconnect","setWrapperElement","element","ResizeObserver","sanitizedStyle","innerStyle","undefined","sanitizeStyle","answerSizeUpdated","emit","height","scrollHeight","bindAnalyticsToLink","link","linkText","innerText","linkURL","href","stopPropagation","onSelect","selectInlineLink","onBeginDelayedSelect","beginDelayedSelectInlineLink","onCancelPendingSelect","cancelPendingSelectInlineLink","bindAnalyticsToLinks","root","Array","from","querySelectorAll","forEach","renderStyle","style","h","innerHTML","renderContent","class","ref","sanitize","htmlContent","USE_PROFILES","html","part","render","Host"],"sources":["src/components/common/smart-snippets/atomic-smart-snippet-answer/atomic-smart-snippet-answer.pcss?tag=atomic-smart-snippet-answer&encapsulation=shadow","src/components/common/smart-snippets/atomic-smart-snippet-answer/atomic-smart-snippet-answer.tsx"],"sourcesContent":[":host {\n  color: var(--atomic-on-background);\n  font-size: var(--atomic-text-lg);\n  line-height: calc(var(--atomic-text-lg) * var(--atomic-line-height-ratio));\n\n  .wrapper {\n    display: flow-root;\n    .margin {\n      margin: 1rem 0;\n    }\n  }\n}\n","import {InlineLink} from '@coveo/headless';\nimport {\n  Component,\n  h,\n  Prop,\n  Event,\n  EventEmitter,\n  Host,\n  Element,\n} from '@stencil/core';\nimport {sanitize} from 'dompurify';\nimport {sanitizeStyle} from '../../../../utils/utils';\nimport {bindAnalyticsToLink} from '../../result-link/result-link';\n\n/**\n * @part answer - The container displaying the full document excerpt.\n * @internal\n */\n@Component({\n  tag: 'atomic-smart-snippet-answer',\n  styleUrl: 'atomic-smart-snippet-answer.pcss',\n  shadow: true,\n})\nexport class AtomicSmartSnippetAnswer {\n  @Prop() htmlContent!: string;\n  @Prop() innerStyle?: string;\n\n  @Element() public host!: HTMLElement;\n\n  @Event({bubbles: false})\n  private answerSizeUpdated!: EventEmitter<{height: number}>;\n  @Event({bubbles: false})\n  private selectInlineLink!: EventEmitter<InlineLink>;\n  @Event({bubbles: false})\n  private beginDelayedSelectInlineLink!: EventEmitter<InlineLink>;\n  @Event({bubbles: false})\n  private cancelPendingSelectInlineLink!: EventEmitter<InlineLink>;\n  private wrapperElement?: HTMLElement;\n  private isRendering = true;\n  private resizeObserver: ResizeObserver | undefined;\n\n  public componentWillRender() {\n    this.isRendering = true;\n  }\n\n  public componentDidRender() {\n    this.isRendering = false;\n    this.emitCurrentHeight();\n  }\n\n  public componentDidLoad() {\n    // Prevents initial transition\n    setTimeout(() => {\n      this.host.classList.add('loaded');\n    }, 0);\n  }\n\n  public connectedCallback() {\n    if (this.wrapperElement && this.resizeObserver) {\n      this.resizeObserver.observe(this.wrapperElement);\n    }\n  }\n\n  public disconnectedCallback() {\n    this.resizeObserver?.disconnect();\n  }\n\n  public setWrapperElement(element: HTMLElement) {\n    this.wrapperElement = element;\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n    this.resizeObserver = new ResizeObserver(() => this.emitCurrentHeight());\n    this.resizeObserver.observe(element);\n  }\n\n  private get sanitizedStyle() {\n    if (!this.innerStyle) {\n      return undefined;\n    }\n    return sanitizeStyle(this.innerStyle);\n  }\n\n  private emitCurrentHeight() {\n    if (this.isRendering) {\n      return;\n    }\n    this.answerSizeUpdated.emit({height: this.wrapperElement!.scrollHeight});\n  }\n\n  private bindAnalyticsToLink(element: HTMLAnchorElement) {\n    const link: InlineLink = {\n      linkText: element.innerText,\n      linkURL: element.href,\n    };\n    bindAnalyticsToLink(element, {\n      stopPropagation: false,\n      onSelect: () => this.selectInlineLink.emit(link),\n      onBeginDelayedSelect: () => this.beginDelayedSelectInlineLink.emit(link),\n      onCancelPendingSelect: () =>\n        this.cancelPendingSelectInlineLink.emit(link),\n    });\n  }\n\n  private bindAnalyticsToLinks(root: HTMLElement) {\n    Array.from(root.querySelectorAll('a')).forEach((link) =>\n      this.bindAnalyticsToLink(link)\n    );\n  }\n\n  private renderStyle() {\n    const style = this.sanitizedStyle;\n    if (!style) {\n      return;\n    }\n    // deepcode ignore ReactSetInnerHtml: Defined by implementer and sanitized by dompurify\n    return <style innerHTML={style}></style>;\n  }\n\n  private renderContent() {\n    return (\n      <div\n        class=\"wrapper\"\n        ref={(element) => element && this.setWrapperElement(element)}\n      >\n        {/* deepcode ignore ReactSetInnerHtml: Sanitized by back-end + dompurify */}\n        <div\n          innerHTML={sanitize(this.htmlContent, {\n            USE_PROFILES: {html: true},\n          })}\n          ref={(element) => element && this.bindAnalyticsToLinks(element)}\n          part=\"answer\"\n          class=\"margin\"\n        ></div>\n      </div>\n    );\n  }\n\n  public render() {\n    return (\n      <Host>\n        {this.renderStyle()}\n        {this.renderContent()}\n      </Host>\n    );\n  }\n}\n"],"mappings":"+LAAA,MAAMA,EAA8B,2N,MCuBvBC,EAAwB,M,yRAe3BC,KAAAC,YAAc,K,qDAGf,mBAAAC,GACLF,KAAKC,YAAc,I,CAGd,kBAAAE,GACLH,KAAKC,YAAc,MACnBD,KAAKI,mB,CAGA,gBAAAC,GAELC,YAAW,KACTN,KAAKO,KAAKC,UAAUC,IAAI,SAAS,GAChC,E,CAGE,iBAAAC,GACL,GAAIV,KAAKW,gBAAkBX,KAAKY,eAAgB,CAC9CZ,KAAKY,eAAeC,QAAQb,KAAKW,e,EAI9B,oBAAAG,G,OACLC,EAAAf,KAAKY,kBAAc,MAAAG,SAAA,SAAAA,EAAEC,Y,CAGhB,iBAAAC,CAAkBC,GACvBlB,KAAKW,eAAiBO,EACtB,GAAIlB,KAAKY,eAAgB,CACvBZ,KAAKY,eAAeI,Y,CAEtBhB,KAAKY,eAAiB,IAAIO,gBAAe,IAAMnB,KAAKI,sBACpDJ,KAAKY,eAAeC,QAAQK,E,CAG9B,kBAAYE,GACV,IAAKpB,KAAKqB,WAAY,CACpB,OAAOC,S,CAET,OAAOC,EAAcvB,KAAKqB,W,CAGpB,iBAAAjB,GACN,GAAIJ,KAAKC,YAAa,CACpB,M,CAEFD,KAAKwB,kBAAkBC,KAAK,CAACC,OAAQ1B,KAAKW,eAAgBgB,c,CAGpD,mBAAAC,CAAoBV,GAC1B,MAAMW,EAAmB,CACvBC,SAAUZ,EAAQa,UAClBC,QAASd,EAAQe,MAEnBL,EAAoBV,EAAS,CAC3BgB,gBAAiB,MACjBC,SAAU,IAAMnC,KAAKoC,iBAAiBX,KAAKI,GAC3CQ,qBAAsB,IAAMrC,KAAKsC,6BAA6Bb,KAAKI,GACnEU,sBAAuB,IACrBvC,KAAKwC,8BAA8Bf,KAAKI,I,CAItC,oBAAAY,CAAqBC,GAC3BC,MAAMC,KAAKF,EAAKG,iBAAiB,MAAMC,SAASjB,GAC9C7B,KAAK4B,oBAAoBC,I,CAIrB,WAAAkB,GACN,MAAMC,EAAQhD,KAAKoB,eACnB,IAAK4B,EAAO,CACV,M,CAGF,OAAOC,EAAA,SAAOC,UAAWF,G,CAGnB,aAAAG,GACN,OACEF,EAAA,OACEG,MAAM,UACNC,IAAMnC,GAAYA,GAAWlB,KAAKiB,kBAAkBC,IAGpD+B,EAAA,OACEC,UAAWI,WAAStD,KAAKuD,YAAa,CACpCC,aAAc,CAACC,KAAM,QAEvBJ,IAAMnC,GAAYA,GAAWlB,KAAKyC,qBAAqBvB,GACvDwC,KAAK,SACLN,MAAM,W,CAMP,MAAAO,GACL,OACEV,EAACW,EAAI,KACF5D,KAAK+C,cACL/C,KAAKmD,gB"}