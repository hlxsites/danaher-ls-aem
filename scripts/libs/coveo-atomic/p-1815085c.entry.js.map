{"version":3,"names":["atomicQuickviewCss","AtomicQuickview","this","sandbox","onNextQuickview","evt","stopImmediatePropagation","quickview","next","onPreviousQuickview","previous","focusTarget","buttonFocusTarget","FocusTargetController","initialize","buildQuickview","bindings","engine","options","result","Schema","StringValue","required","regex","validate","addQuickviewModalIfNeeded","quickviewModalRef","quickviewModal","interfaceElement","querySelector","document","createElement","setAttribute","appendChild","updateModalContent","state","content","total","quickviewState","totalResults","current","currentResult","modalCloseCallback","focus","quickviewAriaMessage","isLoading","i18n","t","first","last","title","onClick","event","stopPropagation","fetchResultContent","render","resultHasPreview","h","Button","part","style","class","ref","setTarget","icon","QuickviewIcon","__decorate","InitializeBindings","ResultContext","BindStateToController","AriaLiveRegion"],"sources":["src/components/search/result-template-components/atomic-quickview/atomic-quickview.pcss?tag=atomic-quickview&encapsulation=shadow","src/components/search/result-template-components/atomic-quickview/atomic-quickview.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\n","import {Schema, StringValue} from '@coveo/bueno';\nimport {\n  Result,\n  buildQuickview,\n  Quickview,\n  QuickviewState,\n} from '@coveo/headless';\nimport {Component, h, Listen, Prop, State} from '@stencil/core';\nimport QuickviewIcon from '../../../../images/quickview.svg';\nimport {\n  AriaLiveRegion,\n  FocusTargetController,\n} from '../../../../utils/accessibility-utils';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {Button} from '../../../common/button';\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\nimport {ResultContext} from '../result-template-decorators';\n\n/**\n * The `atomic-quickview` component renders a button which the end user can click to open a modal box containing a preview\n * about a result.\n *\n * The `atomic-quickview` is not meant to replace the `atomic-result-link` to access an item in a result template; it has certain limitations (e.g., custom styles and embedded\n * images/links may not work as expected in an `atomic-quickview`).\n *\n * @part button - The button that opens the quickview modal on click.\n * @part icon - The icon for the quickview button.\n */\n@Component({\n  tag: 'atomic-quickview',\n  styleUrl: 'atomic-quickview.pcss',\n  shadow: true,\n})\nexport class AtomicQuickview implements InitializableComponent {\n  @InitializeBindings() public bindings!: Bindings;\n  @ResultContext() private result!: Result;\n  private buttonFocusTarget?: FocusTargetController;\n\n  @State() public error!: Error;\n\n  public quickview!: Quickview;\n\n  @BindStateToController('quickview')\n  @State()\n  public quickviewState!: QuickviewState;\n\n  /**\n   * The `sandbox` attribute to apply to the quickview iframe.\n   *\n   * The quickview is loaded inside an iframe with a [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox) attribute for security reasons.\n   *\n   * This attribute exists primarily to protect against potential XSS attacks that could originate from the document being displayed.\n   *\n   * By default, the sandbox attributes are: `allow-popups allow-top-navigation allow-same-origin`.\n   *\n   * `allow-same-origin` is not optional, and must always be included in the list of allowed capabilities for the component to function properly.\n   */\n  @Prop() public sandbox =\n    'allow-popups allow-top-navigation allow-same-origin';\n\n  @AriaLiveRegion('quickview')\n  protected quickviewAriaMessage!: string;\n\n  @Listen('atomic/quickview/next', {target: 'body'})\n  public onNextQuickview(evt: Event) {\n    evt.stopImmediatePropagation();\n    this.quickview.next();\n  }\n\n  @Listen('atomic/quickview/previous', {target: 'body'})\n  public onPreviousQuickview(evt: Event) {\n    evt.stopImmediatePropagation();\n    this.quickview.previous();\n  }\n\n  private quickviewModalRef?: HTMLAtomicQuickviewModalElement;\n\n  public get focusTarget() {\n    if (!this.buttonFocusTarget) {\n      this.buttonFocusTarget = new FocusTargetController(this);\n    }\n    return this.buttonFocusTarget;\n  }\n\n  public initialize() {\n    this.quickview = buildQuickview(this.bindings.engine, {\n      options: {result: this.result},\n    });\n    new Schema({\n      sandbox: new StringValue({\n        required: true,\n        regex: /allow-same-origin/,\n      }),\n    }).validate({sandbox: this.sandbox});\n  }\n\n  private addQuickviewModalIfNeeded() {\n    if (this.quickviewModalRef) {\n      return;\n    }\n\n    const quickviewModal = this.bindings.interfaceElement.querySelector(\n      'atomic-quickview-modal'\n    );\n    if (quickviewModal) {\n      this.quickviewModalRef = quickviewModal;\n      return;\n    }\n    this.quickviewModalRef = document.createElement('atomic-quickview-modal');\n    this.quickviewModalRef.setAttribute('sandbox', this.sandbox);\n    this.bindings.interfaceElement.appendChild(this.quickviewModalRef);\n  }\n\n  private updateModalContent() {\n    if (this.quickviewModalRef && this.quickview.state.content) {\n      this.quickviewModalRef.content = this.quickview.state.content;\n      this.quickviewModalRef.result = this.result;\n      this.quickviewModalRef.total = this.quickviewState.totalResults;\n      this.quickviewModalRef.current = this.quickviewState.currentResult;\n      this.quickviewModalRef.modalCloseCallback = () =>\n        this.focusTarget.focus();\n\n      this.quickviewAriaMessage = this.quickviewState.isLoading\n        ? this.bindings.i18n.t('quickview-loading')\n        : this.bindings.i18n.t('quickview-loaded', {\n            first: this.quickviewState.currentResult,\n            last: this.quickviewState.totalResults,\n            title: this.result.title,\n          });\n    }\n  }\n\n  private onClick(event?: MouseEvent) {\n    event?.stopPropagation();\n    this.quickview.fetchResultContent();\n  }\n\n  public render() {\n    this.addQuickviewModalIfNeeded();\n    this.updateModalContent();\n    if (this.quickviewState.resultHasPreview) {\n      return (\n        <Button\n          part=\"button\"\n          title={this.bindings.i18n.t('quickview')}\n          style=\"outline-primary\"\n          class=\"p-2\"\n          onClick={(event) => this.onClick(event)}\n          ref={this.focusTarget.setTarget}\n        >\n          <atomic-icon\n            part=\"icon\"\n            class=\"w-5\"\n            icon={QuickviewIcon}\n          ></atomic-icon>\n        </Button>\n      );\n    }\n  }\n}\n"],"mappings":"+aAAA,MAAMA,EAAqB,k1gC,iXCqCdC,EAAe,M,yBAwBXC,KAAAC,QACb,sD,gEAAA,qD,CAMK,eAAAC,CAAgBC,GACrBA,EAAIC,2BACJJ,KAAKK,UAAUC,M,CAIV,mBAAAC,CAAoBJ,GACzBA,EAAIC,2BACJJ,KAAKK,UAAUG,U,CAKjB,eAAWC,GACT,IAAKT,KAAKU,kBAAmB,CAC3BV,KAAKU,kBAAoB,IAAIC,EAAsBX,K,CAErD,OAAOA,KAAKU,iB,CAGP,UAAAE,GACLZ,KAAKK,UAAYQ,EAAeb,KAAKc,SAASC,OAAQ,CACpDC,QAAS,CAACC,OAAQjB,KAAKiB,UAEzB,IAAIC,EAAO,CACTjB,QAAS,IAAIkB,EAAY,CACvBC,SAAU,KACVC,MAAO,wBAERC,SAAS,CAACrB,QAASD,KAAKC,S,CAGrB,yBAAAsB,GACN,GAAIvB,KAAKwB,kBAAmB,CAC1B,M,CAGF,MAAMC,EAAiBzB,KAAKc,SAASY,iBAAiBC,cACpD,0BAEF,GAAIF,EAAgB,CAClBzB,KAAKwB,kBAAoBC,EACzB,M,CAEFzB,KAAKwB,kBAAoBI,SAASC,cAAc,0BAChD7B,KAAKwB,kBAAkBM,aAAa,UAAW9B,KAAKC,SACpDD,KAAKc,SAASY,iBAAiBK,YAAY/B,KAAKwB,kB,CAG1C,kBAAAQ,GACN,GAAIhC,KAAKwB,mBAAqBxB,KAAKK,UAAU4B,MAAMC,QAAS,CAC1DlC,KAAKwB,kBAAkBU,QAAUlC,KAAKK,UAAU4B,MAAMC,QACtDlC,KAAKwB,kBAAkBP,OAASjB,KAAKiB,OACrCjB,KAAKwB,kBAAkBW,MAAQnC,KAAKoC,eAAeC,aACnDrC,KAAKwB,kBAAkBc,QAAUtC,KAAKoC,eAAeG,cACrDvC,KAAKwB,kBAAkBgB,mBAAqB,IAC1CxC,KAAKS,YAAYgC,QAEnBzC,KAAK0C,qBAAuB1C,KAAKoC,eAAeO,UAC5C3C,KAAKc,SAAS8B,KAAKC,EAAE,qBACrB7C,KAAKc,SAAS8B,KAAKC,EAAE,mBAAoB,CACvCC,MAAO9C,KAAKoC,eAAeG,cAC3BQ,KAAM/C,KAAKoC,eAAeC,aAC1BW,MAAOhD,KAAKiB,OAAO+B,O,EAKrB,OAAAC,CAAQC,GACdA,IAAK,MAALA,SAAK,SAALA,EAAOC,kBACPnD,KAAKK,UAAU+C,oB,CAGV,MAAAC,GACLrD,KAAKuB,4BACLvB,KAAKgC,qBACL,GAAIhC,KAAKoC,eAAekB,iBAAkB,CACxC,OACEC,EAACC,EAAM,CACLC,KAAK,SACLT,MAAOhD,KAAKc,SAAS8B,KAAKC,EAAE,aAC5Ba,MAAM,kBACNC,MAAM,MACNV,QAAUC,GAAUlD,KAAKiD,QAAQC,GACjCU,IAAK5D,KAAKS,YAAYoD,WAEtBN,EAAA,eACEE,KAAK,OACLE,MAAM,MACNG,KAAMC,I,IAvHaC,EAAA,CAA5BC,K,+BACwBD,EAAA,CAAxBE,K,6BASMF,EAAA,CAFNG,EAAsB,c,qCAmBbH,EAAA,CADTI,EAAe,c"}