{"version":3,"names":["atomicSmartSnippetExpandableAnswerCss","AtomicSmartSnippetExpandableAnswer","this","maximumHeight","collapsedHeight","validateProps","initialize","fullHeightUpdated","host","style","setProperty","fullHeight","showButton","establishInitialHeight","answerElement","document","createElement","htmlContent","innerStyle","snippetStyle","visibility","position","Promise","resolve","listenOnce","event","remove","detail","height","parentElement","appendChild","isExpanded","expanded","componentWillLoad","renderAnswer","h","part","exportparts","onAnswerSizeUpdated","e","onSelectInlineLink","selectInlineLink","emit","onBeginDelayedSelectInlineLink","beginDelayedSelectInlineLink","onCancelPendingSelectInlineLink","cancelPendingSelectInlineLink","renderButton","onClick","collapse","expand","class","bindings","i18n","t","icon","ArrowDown","render","__decorate","InitializeBindings"],"sources":["src/components/common/smart-snippets/atomic-smart-snippet-expandable-answer/atomic-smart-snippet-expandable-answer.pcss?tag=atomic-smart-snippet-expandable-answer&encapsulation=shadow","src/components/common/smart-snippets/atomic-smart-snippet-expandable-answer/atomic-smart-snippet-expandable-answer.tsx"],"sourcesContent":["@import '../../../../global/global.pcss';\n@import '../../../../global/mixins.pcss';\n\n/**\n * @prop --atomic-smart-snippet-gradient-start: At which height to start fading out a truncated answer.\n */\n:host {\n  atomic-smart-snippet-answer {\n    @mixin set-font-size var(--atomic-text-lg);\n\n    display: block;\n    overflow: hidden;\n    height: var(--collapsed-size);\n\n    --gradient-start: var(\n      --atomic-smart-snippet-gradient-start,\n      calc(max(var(--collapsed-size) - (var(--line-height) * 1.5), var(--collapsed-size) * 0.5))\n    );\n    color: var(--atomic-on-background);\n    mask-image: linear-gradient(black, black var(--gradient-start), transparent 100%);\n\n    &.loaded {\n      transition: height ease-in-out 0.25s;\n    }\n  }\n\n  button atomic-icon {\n    @apply relative top-0.5;\n  }\n\n  .expanded {\n    atomic-smart-snippet-answer {\n      height: var(--full-height);\n      mask-image: none;\n    }\n\n    button atomic-icon {\n      @apply -scale-y-100 top-0;\n    }\n  }\n}\n","import {InlineLink} from '@coveo/headless';\nimport {\n  h,\n  Component,\n  State,\n  Prop,\n  Element,\n  Watch,\n  Event,\n  EventEmitter,\n} from '@stencil/core';\nimport ArrowDown from '../../../../images/arrow-down.svg';\nimport {listenOnce} from '../../../../utils/event-utils';\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\nimport {AnyBindings} from '../../interface/bindings';\n\n/**\n * @internal\n */\n@Component({\n  tag: 'atomic-smart-snippet-expandable-answer',\n  styleUrl: 'atomic-smart-snippet-expandable-answer.pcss',\n  shadow: true,\n})\nexport class AtomicSmartSnippetExpandableAnswer {\n  @InitializeBindings() public bindings!: AnyBindings;\n  public error!: Error;\n  @Element() public host!: HTMLElement;\n\n  @Prop({reflect: true}) expanded!: boolean;\n  @Prop() htmlContent!: string;\n  /**\n   * The maximum height (in pixels) a snippet can have before the component truncates it and displays a \"show more\" button.\n   */\n  @Prop({reflect: true}) maximumHeight = 250;\n  /**\n   * When the answer is partly hidden, how much of its height (in pixels) should be visible.\n   */\n  @Prop({reflect: true}) collapsedHeight = 180;\n  /**\n   * Sets the style of the snippet.\n   *\n   * Example:\n   * ```ts\n   * expandableAnswer.snippetStyle = `\n   *   b {\n   *     color: blue;\n   *   }\n   * `;\n   * ```\n   */\n  @Prop() snippetStyle?: string;\n\n  @State() fullHeight?: number;\n\n  @Event() expand!: EventEmitter;\n  @Event() collapse!: EventEmitter;\n  @Event() selectInlineLink!: EventEmitter<InlineLink>;\n  @Event() beginDelayedSelectInlineLink!: EventEmitter<InlineLink>;\n  @Event() cancelPendingSelectInlineLink!: EventEmitter<InlineLink>;\n\n  private validateProps() {\n    if (this.maximumHeight < this.collapsedHeight) {\n      throw 'maximumHeight must be equal or greater than collapsedHeight';\n    }\n  }\n\n  public initialize() {\n    this.validateProps();\n  }\n\n  @Watch('fullHeight')\n  public fullHeightUpdated() {\n    this.host.style.setProperty('--full-height', `${this.fullHeight}px`);\n    this.host.style.setProperty(\n      '--collapsed-size',\n      `${this.showButton ? this.collapsedHeight : this.fullHeight}px`\n    );\n  }\n\n  private establishInitialHeight() {\n    const answerElement = document.createElement('atomic-smart-snippet-answer');\n    answerElement.htmlContent = this.htmlContent;\n    answerElement.innerStyle = this.snippetStyle;\n    answerElement.style.visibility = 'hidden';\n    answerElement.style.position = 'absolute';\n    return new Promise<number>((resolve) => {\n      listenOnce(answerElement, 'answerSizeUpdated', (event) => {\n        answerElement.remove();\n        resolve((event as CustomEvent<{height: number}>).detail.height);\n      });\n      this.host.parentElement!.appendChild(answerElement);\n    });\n  }\n\n  private get showButton() {\n    return this.fullHeight! > this.maximumHeight;\n  }\n\n  private get isExpanded() {\n    return this.expanded || !this.showButton;\n  }\n\n  public async componentWillLoad() {\n    this.fullHeight = await this.establishInitialHeight();\n  }\n\n  public renderAnswer() {\n    return (\n      <div part=\"truncated-answer\">\n        <atomic-smart-snippet-answer\n          exportparts=\"answer\"\n          htmlContent={this.htmlContent}\n          innerStyle={this.snippetStyle}\n          onAnswerSizeUpdated={(e) => (this.fullHeight = e.detail.height)}\n          onSelectInlineLink={(e) => this.selectInlineLink.emit(e.detail)}\n          onBeginDelayedSelectInlineLink={(e) =>\n            this.beginDelayedSelectInlineLink.emit(e.detail)\n          }\n          onCancelPendingSelectInlineLink={(e) =>\n            this.cancelPendingSelectInlineLink.emit(e.detail)\n          }\n        ></atomic-smart-snippet-answer>\n      </div>\n    );\n  }\n\n  public renderButton() {\n    if (!this.showButton) {\n      return;\n    }\n    return (\n      <button\n        onClick={() =>\n          this.isExpanded ? this.collapse.emit() : this.expand.emit()\n        }\n        class=\"text-primary hover:underline mb-4\"\n        part={this.isExpanded ? 'show-less-button' : 'show-more-button'}\n      >\n        {this.bindings.i18n.t(this.isExpanded ? 'show-less' : 'show-more')}\n        <atomic-icon\n          icon={ArrowDown}\n          class=\"w-3 ml-2 align-baseline\"\n        ></atomic-icon>\n      </button>\n    );\n  }\n\n  public render() {\n    return (\n      <div class={this.isExpanded ? 'expanded' : ''}>\n        {this.renderAnswer()}\n        {this.renderButton()}\n      </div>\n    );\n  }\n}\n"],"mappings":"gNAAA,MAAMA,EAAwC,w7iC,iXCwBjCC,EAAkC,M,sSAUtBC,KAAAC,cAAgB,IAIhBD,KAAAE,gBAAkB,I,sEAJF,I,qBAIE,I,sDAuBjC,aAAAC,GACN,GAAIH,KAAKC,cAAgBD,KAAKE,gBAAiB,CAC7C,KAAM,6D,EAIH,UAAAE,GACLJ,KAAKG,e,CAIA,iBAAAE,GACLL,KAAKM,KAAKC,MAAMC,YAAY,gBAAiB,GAAGR,KAAKS,gBACrDT,KAAKM,KAAKC,MAAMC,YACd,mBACA,GAAGR,KAAKU,WAAaV,KAAKE,gBAAkBF,KAAKS,e,CAI7C,sBAAAE,GACN,MAAMC,EAAgBC,SAASC,cAAc,+BAC7CF,EAAcG,YAAcf,KAAKe,YACjCH,EAAcI,WAAahB,KAAKiB,aAChCL,EAAcL,MAAMW,WAAa,SACjCN,EAAcL,MAAMY,SAAW,WAC/B,OAAO,IAAIC,SAAiBC,IAC1BC,EAAWV,EAAe,qBAAsBW,IAC9CX,EAAcY,SACdH,EAASE,EAAwCE,OAAOC,OAAO,IAEjE1B,KAAKM,KAAKqB,cAAeC,YAAYhB,EAAc,G,CAIvD,cAAYF,GACV,OAAOV,KAAKS,WAAcT,KAAKC,a,CAGjC,cAAY4B,GACV,OAAO7B,KAAK8B,WAAa9B,KAAKU,U,CAGzB,uBAAMqB,GACX/B,KAAKS,iBAAmBT,KAAKW,wB,CAGxB,YAAAqB,GACL,OACEC,EAAA,OAAKC,KAAK,oBACRD,EAAA,+BACEE,YAAY,SACZpB,YAAaf,KAAKe,YAClBC,WAAYhB,KAAKiB,aACjBmB,oBAAsBC,GAAOrC,KAAKS,WAAa4B,EAAEZ,OAAOC,OACxDY,mBAAqBD,GAAMrC,KAAKuC,iBAAiBC,KAAKH,EAAEZ,QACxDgB,+BAAiCJ,GAC/BrC,KAAK0C,6BAA6BF,KAAKH,EAAEZ,QAE3CkB,gCAAkCN,GAChCrC,KAAK4C,8BAA8BJ,KAAKH,EAAEZ,U,CAO7C,YAAAoB,GACL,IAAK7C,KAAKU,WAAY,CACpB,M,CAEF,OACEuB,EAAA,UACEa,QAAS,IACP9C,KAAK6B,WAAa7B,KAAK+C,SAASP,OAASxC,KAAKgD,OAAOR,OAEvDS,MAAM,oCACNf,KAAMlC,KAAK6B,WAAa,mBAAqB,oBAE5C7B,KAAKkD,SAASC,KAAKC,EAAEpD,KAAK6B,WAAa,YAAc,aACtDI,EAAA,eACEoB,KAAMC,EACNL,MAAM,4B,CAMP,MAAAM,GACL,OACEtB,EAAA,OAAKgB,MAAOjD,KAAK6B,WAAa,WAAa,IACxC7B,KAAKgC,eACLhC,KAAK6C,e,4FA/HiBW,EAAA,CAA5BC,K"}