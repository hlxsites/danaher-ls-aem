{"version":3,"names":["atomicResultsPerPageCss","AtomicResultsPerPage","this","radioGroupName","randomID","choicesDisplayed","initialize","choices","validateChoicesDisplayed","validateInitialChoice","searchStatus","buildSearchStatus","bindings","engine","resultPerPage","buildResultsPerPage","initialState","numberOfResults","initialChoice","split","map","choice","parsedChoice","parseInt","isNaN","errorMsg","logger","error","Error","includes","buildChoice","isSelected","isSetTo","parts","push","text","toLocaleString","i18n","language","h","RadioButton","key","groupName","style","checked","ariaLabel","onChecked","focusOnProperResultDependingOnChoice","set","class","part","join","resultPerPageState","_a","store","state","resultList","focusOnFirstResultAfterNextSearch","then","scrollToTopEvent","emit","_b","focusOnNextNewResult","render","isAppLoaded","searchStatusState","hasResults","label","t","FieldsetGroup","role","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/search/atomic-results-per-page/atomic-results-per-page.pcss?tag=atomic-results-per-page&encapsulation=shadow","src/components/search/atomic-results-per-page/atomic-results-per-page.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\n\n.btn-page {\n  @apply w-10 h-10;\n}\n","import {\n  ResultsPerPage,\n  buildResultsPerPage,\n  ResultsPerPageState,\n  buildSearchStatus,\n  SearchStatus,\n  SearchStatusState,\n} from '@coveo/headless';\nimport {Component, Event, EventEmitter, h, Prop, State} from '@stencil/core';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {randomID} from '../../../utils/utils';\nimport {FieldsetGroup} from '../../common/fieldset-group';\nimport {RadioButton} from '../../common/radio-button';\nimport {Bindings} from '../atomic-search-interface/atomic-search-interface';\n\n/**\n * The `atomic-results-per-page` component determines how many results to display per page.\n *\n * @part label - The \"Results per page\" label.\n * @part buttons - The list of buttons.\n * @part button - The result per page button.\n * @part active-button - The active result per page button.\n */\n@Component({\n  tag: 'atomic-results-per-page',\n  styleUrl: 'atomic-results-per-page.pcss',\n  shadow: true,\n})\nexport class AtomicResultsPerPage implements InitializableComponent {\n  @InitializeBindings() public bindings!: Bindings;\n  private resultPerPage!: ResultsPerPage;\n  public searchStatus!: SearchStatus;\n  private choices!: number[];\n  private readonly radioGroupName = randomID('atomic-results-per-page-');\n\n  @State()\n  @BindStateToController('resultPerPage')\n  public resultPerPageState!: ResultsPerPageState;\n  @BindStateToController('searchStatus')\n  @State()\n  private searchStatusState!: SearchStatusState;\n  @State() public error!: Error;\n\n  /**\n   * A list of choices for the number of results to display per page, separated by commas.\n   */\n  @Prop({reflect: true}) choicesDisplayed = '10,25,50,100';\n  /**\n   * The initial selection for the number of result per page. This should be part of the `choicesDisplayed` option. By default, this is set to the first value in `choicesDisplayed`.\n   */\n  @Prop({mutable: true, reflect: true}) initialChoice?: number;\n\n  @Event({\n    eventName: 'atomic/scrollToTop',\n  })\n  private scrollToTopEvent!: EventEmitter;\n\n  public initialize() {\n    this.choices = this.validateChoicesDisplayed();\n    this.validateInitialChoice();\n\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\n    this.resultPerPage = buildResultsPerPage(this.bindings.engine, {\n      initialState: {numberOfResults: this.initialChoice},\n    });\n  }\n\n  private validateChoicesDisplayed() {\n    return this.choicesDisplayed.split(',').map((choice) => {\n      const parsedChoice = parseInt(choice);\n      if (isNaN(parsedChoice)) {\n        const errorMsg = `The choice value \"${choice}\" from the \"choicesDisplayed\" option is not a number.`;\n        this.bindings.engine.logger.error(errorMsg, this);\n        throw new Error(errorMsg);\n      }\n\n      return parsedChoice;\n    });\n  }\n\n  private validateInitialChoice() {\n    if (!this.initialChoice) {\n      this.initialChoice = this.choices[0];\n      return;\n    }\n    if (!this.choices.includes(this.initialChoice)) {\n      const errorMsg = `The \"initialChoice\" option value \"${this.initialChoice}\" is not included in the \"choicesDisplayed\" option \"${this.choicesDisplayed}\".`;\n      this.bindings.engine.logger.error(errorMsg, this);\n      throw new Error(errorMsg);\n    }\n  }\n\n  private buildChoice(choice: number) {\n    const isSelected = this.resultPerPage.isSetTo(choice);\n    const parts = ['button'];\n    if (isSelected) {\n      parts.push('active-button');\n    }\n    const text = choice.toLocaleString(this.bindings.i18n.language);\n\n    return (\n      <RadioButton\n        key={choice}\n        groupName={this.radioGroupName}\n        style=\"outline-neutral\"\n        checked={isSelected}\n        ariaLabel={text}\n        onChecked={() => {\n          this.focusOnProperResultDependingOnChoice(choice);\n          this.resultPerPage.set(choice);\n        }}\n        class=\"btn-page focus-visible:bg-neutral-light\"\n        part={parts.join(' ')}\n        text={text}\n      ></RadioButton>\n    );\n  }\n\n  private focusOnProperResultDependingOnChoice(choice: number) {\n    if (choice < this.resultPerPageState.numberOfResults) {\n      this.bindings.store.state.resultList\n        ?.focusOnFirstResultAfterNextSearch()\n        .then(() => this.scrollToTopEvent.emit());\n    } else if (choice > this.resultPerPageState.numberOfResults) {\n      this.bindings.store.state.resultList?.focusOnNextNewResult();\n    }\n  }\n\n  public render() {\n    if (\n      !this.bindings.store.isAppLoaded() ||\n      !this.searchStatusState.hasResults\n    ) {\n      return;\n    }\n\n    const label = this.bindings.i18n.t('results-per-page');\n\n    return (\n      <div class=\"flex items-center\">\n        <span\n          part=\"label\"\n          class=\"self-start text-on-background text-lg mr-3 leading-10\"\n          aria-hidden=\"true\"\n        >\n          {label}\n        </span>\n        <FieldsetGroup label={label}>\n          <div\n            part=\"buttons\"\n            role=\"radiogroup\"\n            aria-label={this.bindings.i18n.t('results-per-page')}\n            class=\"flex flex-wrap gap-2\"\n          >\n            {this.choices.map((choice) => this.buildChoice(choice))}\n          </div>\n        </FieldsetGroup>\n      </div>\n    );\n  }\n}\n"],"mappings":"+UAAA,MAAMA,EAA0B,u3gC,iXCgCnBC,EAAoB,M,8EAKdC,KAAAC,eAAiBC,EAAS,4BAapBF,KAAAG,iBAAmB,e,8GAAA,e,6BAWnC,UAAAC,GACLJ,KAAKK,QAAUL,KAAKM,2BACpBN,KAAKO,wBAELP,KAAKQ,aAAeC,EAAkBT,KAAKU,SAASC,QACpDX,KAAKY,cAAgBC,EAAoBb,KAAKU,SAASC,OAAQ,CAC7DG,aAAc,CAACC,gBAAiBf,KAAKgB,gB,CAIjC,wBAAAV,GACN,OAAON,KAAKG,iBAAiBc,MAAM,KAAKC,KAAKC,IAC3C,MAAMC,EAAeC,SAASF,GAC9B,GAAIG,MAAMF,GAAe,CACvB,MAAMG,EAAW,qBAAqBJ,yDACtCnB,KAAKU,SAASC,OAAOa,OAAOC,MAAMF,EAAUvB,MAC5C,MAAM,IAAI0B,MAAMH,E,CAGlB,OAAOH,CAAY,G,CAIf,qBAAAb,GACN,IAAKP,KAAKgB,cAAe,CACvBhB,KAAKgB,cAAgBhB,KAAKK,QAAQ,GAClC,M,CAEF,IAAKL,KAAKK,QAAQsB,SAAS3B,KAAKgB,eAAgB,CAC9C,MAAMO,EAAW,qCAAqCvB,KAAKgB,oEAAoEhB,KAAKG,qBACpIH,KAAKU,SAASC,OAAOa,OAAOC,MAAMF,EAAUvB,MAC5C,MAAM,IAAI0B,MAAMH,E,EAIZ,WAAAK,CAAYT,GAClB,MAAMU,EAAa7B,KAAKY,cAAckB,QAAQX,GAC9C,MAAMY,EAAQ,CAAC,UACf,GAAIF,EAAY,CACdE,EAAMC,KAAK,gB,CAEb,MAAMC,EAAOd,EAAOe,eAAelC,KAAKU,SAASyB,KAAKC,UAEtD,OACEC,EAACC,EAAW,CACVC,IAAKpB,EACLqB,UAAWxC,KAAKC,eAChBwC,MAAM,kBACNC,QAASb,EACTc,UAAWV,EACXW,UAAW,KACT5C,KAAK6C,qCAAqC1B,GAC1CnB,KAAKY,cAAckC,IAAI3B,EAAO,EAEhC4B,MAAM,0CACNC,KAAMjB,EAAMkB,KAAK,KACjBhB,KAAMA,G,CAKJ,oCAAAY,CAAqC1B,G,QAC3C,GAAIA,EAASnB,KAAKkD,mBAAmBnC,gBAAiB,EACpDoC,EAAAnD,KAAKU,SAAS0C,MAAMC,MAAMC,cAAU,MAAAH,SAAA,SAAAA,EAChCI,oCACDC,MAAK,IAAMxD,KAAKyD,iBAAiBC,Q,MAC/B,GAAIvC,EAASnB,KAAKkD,mBAAmBnC,gBAAiB,EAC3D4C,EAAA3D,KAAKU,SAAS0C,MAAMC,MAAMC,cAAU,MAAAK,SAAA,SAAAA,EAAEC,sB,EAInC,MAAAC,GACL,IACG7D,KAAKU,SAAS0C,MAAMU,gBACpB9D,KAAK+D,kBAAkBC,WACxB,CACA,M,CAGF,MAAMC,EAAQjE,KAAKU,SAASyB,KAAK+B,EAAE,oBAEnC,OACE7B,EAAA,OAAKU,MAAM,qBACTV,EAAA,QACEW,KAAK,QACLD,MAAM,wDAAuD,cACjD,QAEXkB,GAEH5B,EAAC8B,EAAa,CAACF,MAAOA,GACpB5B,EAAA,OACEW,KAAK,UACLoB,KAAK,aAAY,aACLpE,KAAKU,SAASyB,KAAK+B,EAAE,oBACjCnB,MAAM,wBAEL/C,KAAKK,QAAQa,KAAKC,GAAWnB,KAAK4B,YAAYT,O,GA7H5BkD,EAAA,CAA5BC,K,+BAQMD,EAAA,CADNE,EAAsB,kB,yCAIfF,EAAA,CAFPE,EAAsB,iB"}