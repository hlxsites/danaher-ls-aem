{"version":3,"names":["atomicResultChildrenCss","childTemplateComponent","componentTag","AtomicResultChildren","this","resultTemplateRegistered","templateHasError","showInitialChildren","inheritTemplates","noResultText","resolveChildTemplates","event","preventDefault","detail","resultTemplateProvider","initialize","resultChildrenCommon","ResultChildrenCommon","getHost","host","getBindings","bindings","getResult","result","getShowInitialChildren","getFoldedResultList","foldedResultList","getInitialChildren","initialChildren","getInheritTemplates","getResultTemplateRegistered","getTemplateHasError","getNoResultText","getDisplayConfig","displayConfig","getImageSize","imageSize","getFoldedResultListState","foldedResultListState","renderChild","bind","setInitialChildren","toggleShowInitialChildren","childrenTemplates","Array","from","querySelectorAll","filter","template","elementHasAncestorTag","length","error","Error","ResultTemplateProvider","includeDefaultTemplate","templateElements","setResultTemplateRegistered","value","setTemplateHasError","child","isLast","content","_a","getTemplateContent","key","uniqueId","children","map","h","interactiveResult","buildInteractiveResult","engine","options","extractUnfoldedResult","store","density","classes","trim","componentWillRender","render","__decorate","InitializeBindings","ChildTemplatesContext","FoldedResultListContext","ResultContext","folded","ResultDisplayConfigContext","FoldedResultListStateContext"],"sources":["src/components/search/result-lists/atomic-result-children/atomic-result-children.pcss?tag=atomic-result-children&encapsulation=shadow","src/components/search/result-lists/atomic-result-children/atomic-result-children.tsx"],"sourcesContent":["@import '../../../../components/common/result-children/result-children.pcss';\n","import {\n  buildInteractiveResult,\n  FoldedResult,\n  FoldedResultList,\n  FoldedResultListState,\n} from '@coveo/headless';\nimport {Component, Element, State, h, Listen, Prop} from '@stencil/core';\nimport {\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {elementHasAncestorTag} from '../../../../utils/utils';\nimport {extractUnfoldedResult} from '../../../common/interface/result';\nimport {ResultDisplayImageSize} from '../../../common/layout/display-options';\nimport {ResultChildrenCommon} from '../../../common/result-children/result-children-common';\nimport {\n  FoldedResultListContext,\n  FoldedResultListStateContext,\n} from '../../../common/result-list/result-list-decorators';\nimport {ResultTemplateProvider} from '../../../common/result-list/result-template-provider';\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\nimport {\n  ResultContext,\n  ChildTemplatesContextEvent,\n  ResultDisplayConfigContext,\n  DisplayConfig,\n  ChildTemplatesContext,\n} from '../../result-template-components/result-template-decorators';\n\nconst childTemplateComponent = 'atomic-result-children-template';\nconst componentTag = 'atomic-result-children';\n\n/**\n * The `atomic-result-children` component is responsible for displaying child results by applying one or more child result templates.\n * Includes two slots, \"before-children\" and \"after-children\", which allow for rendering content before and after the list of children,\n * only when children exist.\n * @part no-result-root - The wrapper for the message when there are no results.\n * @part show-hide-button - The button that allows to collapse or show all child results.\n * @slot before-children - Slot that allows rendering content before the list of children, only when children exist.\n * @slot after-children - Slot that allows rendering content after the list of children, only when children exist.\n */\n@Component({\n  tag: 'atomic-result-children',\n  styleUrl: 'atomic-result-children.pcss',\n  shadow: true,\n})\nexport class AtomicResultChildren implements InitializableComponent {\n  @InitializeBindings() public bindings!: Bindings;\n  @ChildTemplatesContext()\n  public resultTemplateProvider?: ResultTemplateProvider;\n  @FoldedResultListContext()\n  private foldedResultList!: FoldedResultList;\n  @ResultContext({folded: true})\n  private result!: FoldedResult;\n  @ResultDisplayConfigContext()\n  private displayConfig!: DisplayConfig;\n  private initialChildren!: FoldedResult[];\n\n  @Element() public host!: HTMLDivElement;\n  @State() public error!: Error;\n  @State() private resultTemplateRegistered = false;\n  @State() private templateHasError = false;\n  @FoldedResultListStateContext()\n  @State()\n  private foldedResultListState!: FoldedResultListState;\n  @State()\n  private showInitialChildren = false;\n\n  /**\n   * Whether to inherit templates defined in a parent atomic-result-children. Only works for the second level of child nesting.\n   */\n  @Prop() inheritTemplates = false;\n  /**\n   * The expected size of the image displayed in the children results.\n   */\n  @Prop({reflect: true}) imageSize?: ResultDisplayImageSize;\n  /**\n   * The non-localized copy for an empty result state. An empty string will result in the component being hidden.\n   */\n  @Prop() public noResultText = 'no-documents-related';\n\n  private resultChildrenCommon!: ResultChildrenCommon;\n\n  @Listen('atomic/resolveChildTemplates')\n  public resolveChildTemplates(event: ChildTemplatesContextEvent) {\n    event.preventDefault();\n    event.detail(this.resultTemplateProvider);\n  }\n\n  public initialize() {\n    this.resultChildrenCommon = new ResultChildrenCommon({\n      getHost: () => this.host,\n      getBindings: () => this.bindings,\n      getResult: () => this.result,\n      getShowInitialChildren: () => this.showInitialChildren,\n      getFoldedResultList: () => this.foldedResultList,\n      getInitialChildren: () => this.initialChildren,\n      getInheritTemplates: () => this.inheritTemplates,\n      getResultTemplateRegistered: () => this.resultTemplateRegistered,\n      getTemplateHasError: () => this.templateHasError,\n      getNoResultText: () => this.noResultText,\n      getDisplayConfig: () => this.displayConfig,\n      getImageSize: () => this.imageSize,\n      getFoldedResultListState: () => this.foldedResultListState,\n      renderChild: this.renderChild.bind(this),\n      setInitialChildren: (initialChildren: FoldedResult[]) =>\n        (this.initialChildren = initialChildren),\n      toggleShowInitialChildren: () =>\n        (this.showInitialChildren = !this.showInitialChildren),\n    });\n\n    if (this.inheritTemplates) {\n      return;\n    }\n\n    const childrenTemplates = Array.from(\n      this.host.querySelectorAll(childTemplateComponent)\n    ).filter(\n      (template) => !elementHasAncestorTag(template, childTemplateComponent)\n    );\n\n    if (!childrenTemplates.length) {\n      this.error = new Error(\n        `The \"${componentTag}\" component requires at least one \"${childTemplateComponent}\" component.`\n      );\n      return;\n    }\n\n    this.resultTemplateProvider = new ResultTemplateProvider({\n      includeDefaultTemplate: false,\n      templateElements: childrenTemplates,\n      getResultTemplateRegistered: () => this.resultTemplateRegistered,\n      getTemplateHasError: () => this.templateHasError,\n      setResultTemplateRegistered: (value: boolean) => {\n        this.resultTemplateRegistered = value;\n      },\n      setTemplateHasError: (value: boolean) => {\n        this.templateHasError = value;\n      },\n      bindings: this.bindings,\n    });\n  }\n\n  private renderChild(child: FoldedResult, isLast: boolean) {\n    const content = this.resultTemplateProvider?.getTemplateContent(\n      child.result\n    );\n\n    if (!content) {\n      return;\n    }\n\n    const key =\n      child.result.uniqueId +\n      child.children.map((child) => child.result.uniqueId);\n    return (\n      <atomic-result\n        key={key}\n        content={content}\n        result={child}\n        interactiveResult={buildInteractiveResult(this.bindings.engine, {\n          options: {result: extractUnfoldedResult(child)},\n        })}\n        store={this.bindings.store}\n        density={this.displayConfig.density}\n        imageSize={this.imageSize || this.displayConfig.imageSize}\n        classes={`child-result ${isLast ? 'last-child' : ''}`.trim()}\n      ></atomic-result>\n    );\n  }\n\n  public componentWillRender() {\n    this.resultChildrenCommon.componentWillRender();\n  }\n\n  public render() {\n    return this.resultChildrenCommon.render();\n  }\n}\n"],"mappings":"kfAAA,MAAMA,EAA0B,wjhC,2WC6BhC,MAAMC,EAAyB,kCAC/B,MAAMC,EAAe,yB,MAgBRC,EAAoB,M,yBAcdC,KAAAC,yBAA2B,MAC3BD,KAAAE,iBAAmB,MAK5BF,KAAAG,oBAAsB,MAKtBH,KAAAI,iBAAmB,MAQZJ,KAAAK,aAAe,uB,mDAnBc,M,sBACR,M,8DAKN,M,sBAKH,M,2CAQG,sB,CAKvB,qBAAAC,CAAsBC,GAC3BA,EAAMC,iBACND,EAAME,OAAOT,KAAKU,uB,CAGb,UAAAC,GACLX,KAAKY,qBAAuB,IAAIC,EAAqB,CACnDC,QAAS,IAAMd,KAAKe,KACpBC,YAAa,IAAMhB,KAAKiB,SACxBC,UAAW,IAAMlB,KAAKmB,OACtBC,uBAAwB,IAAMpB,KAAKG,oBACnCkB,oBAAqB,IAAMrB,KAAKsB,iBAChCC,mBAAoB,IAAMvB,KAAKwB,gBAC/BC,oBAAqB,IAAMzB,KAAKI,iBAChCsB,4BAA6B,IAAM1B,KAAKC,yBACxC0B,oBAAqB,IAAM3B,KAAKE,iBAChC0B,gBAAiB,IAAM5B,KAAKK,aAC5BwB,iBAAkB,IAAM7B,KAAK8B,cAC7BC,aAAc,IAAM/B,KAAKgC,UACzBC,yBAA0B,IAAMjC,KAAKkC,sBACrCC,YAAanC,KAAKmC,YAAYC,KAAKpC,MACnCqC,mBAAqBb,GAClBxB,KAAKwB,gBAAkBA,EAC1Bc,0BAA2B,IACxBtC,KAAKG,qBAAuBH,KAAKG,sBAGtC,GAAIH,KAAKI,iBAAkB,CACzB,M,CAGF,MAAMmC,EAAoBC,MAAMC,KAC9BzC,KAAKe,KAAK2B,iBAAiB7C,IAC3B8C,QACCC,IAAcC,EAAsBD,EAAU/C,KAGjD,IAAK0C,EAAkBO,OAAQ,CAC7B9C,KAAK+C,MAAQ,IAAIC,MACf,QAAQlD,uCAAkDD,iBAE5D,M,CAGFG,KAAKU,uBAAyB,IAAIuC,EAAuB,CACvDC,uBAAwB,MACxBC,iBAAkBZ,EAClBb,4BAA6B,IAAM1B,KAAKC,yBACxC0B,oBAAqB,IAAM3B,KAAKE,iBAChCkD,4BAA8BC,IAC5BrD,KAAKC,yBAA2BoD,CAAK,EAEvCC,oBAAsBD,IACpBrD,KAAKE,iBAAmBmD,CAAK,EAE/BpC,SAAUjB,KAAKiB,U,CAIX,WAAAkB,CAAYoB,EAAqBC,G,MACvC,MAAMC,GAAUC,EAAA1D,KAAKU,0BAAsB,MAAAgD,SAAA,SAAAA,EAAEC,mBAC3CJ,EAAMpC,QAGR,IAAKsC,EAAS,CACZ,M,CAGF,MAAMG,EACJL,EAAMpC,OAAO0C,SACbN,EAAMO,SAASC,KAAKR,GAAUA,EAAMpC,OAAO0C,WAC7C,OACEG,EAAA,iBACEJ,IAAKA,EACLH,QAASA,EACTtC,OAAQoC,EACRU,kBAAmBC,EAAuBlE,KAAKiB,SAASkD,OAAQ,CAC9DC,QAAS,CAACjD,OAAQkD,EAAsBd,MAE1Ce,MAAOtE,KAAKiB,SAASqD,MACrBC,QAASvE,KAAK8B,cAAcyC,QAC5BvC,UAAWhC,KAAKgC,WAAahC,KAAK8B,cAAcE,UAChDwC,QAAS,gBAAgBhB,EAAS,aAAe,KAAKiB,Q,CAKrD,mBAAAC,GACL1E,KAAKY,qBAAqB8D,qB,CAGrB,MAAAC,GACL,OAAO3E,KAAKY,qBAAqB+D,Q,6BAjINC,EAAA,CAA5BC,K,+BAEMD,EAAA,CADNE,K,6CAGOF,EAAA,CADPG,K,uCAGOH,EAAA,CADPI,EAAc,CAACC,OAAQ,Q,6BAGhBL,EAAA,CADPM,K,oCAUON,EAAA,CAFPO,K"}