{"version":3,"names":["rectEquals","r1","r2","x","y","width","height","atomicInsightRefineModalCss","AtomicInsightRefineModal","this","isOpen","watchEnabled","host","querySelector","append","getClonedFacetElements","bindings","store","getFacetElements","interfaceElement","onAnimationFrame","dimensionChanged","updateDimensions","window","requestAnimationFrame","interfaceDimensions","getBoundingClientRect","initialize","querySummary","buildInsightQuerySummary","engine","breadcrumbManager","buildInsightBreadcrumbManager","renderHeader","h","class","i18n","t","breadcrumbManagerState","hasBreadcrumbs","Button","onClick","deselectAll","style","text","renderBody","length","Hidden","slot","name","render","Host","top","left","RefineModalCommon","onClose","querySummaryState","title","openButton","scope","componentDidLoad","display","__decorate","InitializeBindings","BindStateToController"],"sources":["src/utils/dom-utils.tsx","src/components/insight/atomic-insight-refine-modal/atomic-insight-refine-modal.pcss?tag=atomic-insight-refine-modal&encapsulation=shadow","src/components/insight/atomic-insight-refine-modal/atomic-insight-refine-modal.tsx"],"sourcesContent":["export function rectEquals(r1: DOMRect, r2: DOMRect) {\n  return (\n    r1.x === r2.x &&\n    r1.y === r2.y &&\n    r1.width === r2.width &&\n    r1.height === r2.height\n  );\n}\n","@import '../../common/refine-modal/refine-modal-common.pcss';\n","import {Component, h, State, Prop, Element, Watch, Host} from '@stencil/core';\nimport {\n  InsightQuerySummary,\n  InsightQuerySummaryState,\n  buildInsightQuerySummary,\n  InsightBreadcrumbManager,\n  InsightBreadcrumbManagerState,\n  buildInsightBreadcrumbManager,\n} from '..';\nimport {rectEquals} from '../../../utils/dom-utils';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {Button} from '../../common/button';\nimport {Hidden} from '../../common/hidden';\nimport {\n  getClonedFacetElements,\n  RefineModalCommon,\n} from '../../common/refine-modal/refine-modal-common';\nimport {InsightBindings} from '../atomic-insight-interface/atomic-insight-interface';\n\n/**\n * @internal\n */\n@Component({\n  tag: 'atomic-insight-refine-modal',\n  styleUrl: 'atomic-insight-refine-modal.pcss',\n  shadow: true,\n})\nexport class AtomicInsightRefineModal\n  implements InitializableComponent<InsightBindings>\n{\n  @InitializeBindings() public bindings!: InsightBindings;\n  @Element() public host!: HTMLElement;\n\n  @BindStateToController('querySummary')\n  @State()\n  public querySummaryState!: InsightQuerySummaryState;\n\n  @BindStateToController('breadcrumbManager')\n  @State()\n  public breadcrumbManagerState!: InsightBreadcrumbManagerState;\n\n  @State()\n  public error!: Error;\n\n  @State()\n  public interfaceDimensions?: DOMRect;\n\n  @Prop({mutable: true}) openButton?: HTMLElement;\n\n  @Prop({reflect: true, mutable: true}) isOpen = false;\n\n  public querySummary!: InsightQuerySummary;\n  private breadcrumbManager!: InsightBreadcrumbManager;\n\n  @Watch('isOpen')\n  watchEnabled(isOpen: boolean) {\n    if (isOpen) {\n      if (!this.host.querySelector('div[slot=\"facets\"]')) {\n        this.host.append(\n          getClonedFacetElements(\n            this.bindings.store.getFacetElements(),\n            0,\n            this.bindings.interfaceElement\n          )\n        );\n      }\n      this.onAnimationFrame();\n    }\n  }\n\n  private onAnimationFrame() {\n    if (!this.isOpen) {\n      return;\n    }\n    if (this.dimensionChanged()) {\n      this.updateDimensions();\n    }\n    window.requestAnimationFrame(() => this.onAnimationFrame());\n  }\n\n  private dimensionChanged() {\n    if (!this.interfaceDimensions) {\n      return true;\n    }\n\n    return !rectEquals(\n      this.interfaceDimensions,\n      this.bindings.interfaceElement.getBoundingClientRect()\n    );\n  }\n\n  public updateDimensions() {\n    this.interfaceDimensions =\n      this.bindings.interfaceElement.getBoundingClientRect();\n  }\n\n  public initialize() {\n    this.querySummary = buildInsightQuerySummary(this.bindings.engine);\n    this.breadcrumbManager = buildInsightBreadcrumbManager(\n      this.bindings.engine\n    );\n  }\n\n  private renderHeader() {\n    return (\n      <div class=\"w-full flex justify-between mb-3\">\n        <h2 class=\"text-2xl font-bold truncate\">\n          {this.bindings.i18n.t('filters')}\n        </h2>\n        {this.breadcrumbManagerState.hasBreadcrumbs && (\n          <Button\n            onClick={() => this.breadcrumbManager.deselectAll()}\n            style=\"text-primary\"\n            text={this.bindings.i18n.t('clear-all-filters')}\n            class=\"px-2 py-1\"\n          ></Button>\n        )}\n      </div>\n    );\n  }\n\n  private renderBody() {\n    if (!this.bindings.store.getFacetElements().length) {\n      return <Hidden></Hidden>;\n    }\n\n    return (\n      <aside slot=\"body\" class=\"flex flex-col w-full adjust-for-scroll-bar\">\n        {this.renderHeader()}\n        <slot name=\"facets\"></slot>\n      </aside>\n    );\n  }\n\n  public render() {\n    return (\n      <Host>\n        {this.interfaceDimensions && (\n          <style>\n            {`atomic-modal::part(backdrop) {\n            top: ${this.interfaceDimensions.top}px;\n            left: ${this.interfaceDimensions.left}px;\n            width: ${this.interfaceDimensions.width}px;\n            height: ${this.interfaceDimensions.height}px;\n            }`}\n          </style>\n        )}\n        <RefineModalCommon\n          bindings={this.bindings}\n          host={this.host}\n          isOpen={this.isOpen}\n          onClose={() => (this.isOpen = false)}\n          querySummaryState={this.querySummaryState}\n          title={this.bindings.i18n.t('filters')}\n          openButton={this.openButton}\n          scope={this.bindings.interfaceElement}\n        >\n          {this.renderBody()}\n        </RefineModalCommon>\n      </Host>\n    );\n  }\n\n  public componentDidLoad() {\n    this.host.style.display = '';\n  }\n}\n"],"mappings":"yaAAgBA,EAAWC,EAAaC,GACtC,OACED,EAAGE,IAAMD,EAAGC,GACZF,EAAGG,IAAMF,EAAGE,GACZH,EAAGI,QAAUH,EAAGG,OAChBJ,EAAGK,SAAWJ,EAAGI,MAErB,CCPA,MAAMC,EAA8B,u5gC,iXC+BvBC,EAAwB,M,yBAsBGC,KAAAC,OAAS,M,qKAAA,K,CAM/C,YAAAC,CAAaD,GACX,GAAIA,EAAQ,CACV,IAAKD,KAAKG,KAAKC,cAAc,sBAAuB,CAClDJ,KAAKG,KAAKE,OACRC,EACEN,KAAKO,SAASC,MAAMC,mBACpB,EACAT,KAAKO,SAASG,kB,CAIpBV,KAAKW,kB,EAID,gBAAAA,GACN,IAAKX,KAAKC,OAAQ,CAChB,M,CAEF,GAAID,KAAKY,mBAAoB,CAC3BZ,KAAKa,kB,CAEPC,OAAOC,uBAAsB,IAAMf,KAAKW,oB,CAGlC,gBAAAC,GACN,IAAKZ,KAAKgB,oBAAqB,CAC7B,OAAO,I,CAGT,OAAQzB,EACNS,KAAKgB,oBACLhB,KAAKO,SAASG,iBAAiBO,wB,CAI5B,gBAAAJ,GACLb,KAAKgB,oBACHhB,KAAKO,SAASG,iBAAiBO,uB,CAG5B,UAAAC,GACLlB,KAAKmB,aAAeC,EAAyBpB,KAAKO,SAASc,QAC3DrB,KAAKsB,kBAAoBC,EACvBvB,KAAKO,SAASc,O,CAIV,YAAAG,GACN,OACEC,EAAA,OAAKC,MAAM,oCACTD,EAAA,MAAIC,MAAM,+BACP1B,KAAKO,SAASoB,KAAKC,EAAE,YAEvB5B,KAAK6B,uBAAuBC,gBAC3BL,EAACM,EAAM,CACLC,QAAS,IAAMhC,KAAKsB,kBAAkBW,cACtCC,MAAM,eACNC,KAAMnC,KAAKO,SAASoB,KAAKC,EAAE,qBAC3BF,MAAM,c,CAOR,UAAAU,GACN,IAAKpC,KAAKO,SAASC,MAAMC,mBAAmB4B,OAAQ,CAClD,OAAOZ,EAACa,EAAM,K,CAGhB,OACEb,EAAA,SAAOc,KAAK,OAAOb,MAAM,8CACtB1B,KAAKwB,eACNC,EAAA,QAAMe,KAAK,W,CAKV,MAAAC,GACL,OACEhB,EAACiB,EAAI,KACF1C,KAAKgB,qBACJS,EAAA,aACG,oDACMzB,KAAKgB,oBAAoB2B,6BACxB3C,KAAKgB,oBAAoB4B,+BACxB5C,KAAKgB,oBAAoBpB,iCACxBI,KAAKgB,oBAAoBnB,4BAIvC4B,EAACoB,EAAiB,CAChBtC,SAAUP,KAAKO,SACfJ,KAAMH,KAAKG,KACXF,OAAQD,KAAKC,OACb6C,QAAS,IAAO9C,KAAKC,OAAS,MAC9B8C,kBAAmB/C,KAAK+C,kBACxBC,MAAOhD,KAAKO,SAASoB,KAAKC,EAAE,WAC5BqB,WAAYjD,KAAKiD,WACjBC,MAAOlD,KAAKO,SAASG,kBAEpBV,KAAKoC,c,CAMP,gBAAAe,GACLnD,KAAKG,KAAK+B,MAAMkB,QAAU,E,mFAtICC,EAAA,CAA5BC,K,+BAKMD,EAAA,CAFNE,EAAsB,iB,wCAMhBF,EAAA,CAFNE,EAAsB,sB"}