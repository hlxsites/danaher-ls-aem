{"version":3,"names":["atomicResultPrintableUriCss","AtomicResultPrintableUri","this","listExpanded","maxNumberOfParts","focusTarget","expandedPartFocus","FocusTargetController","connectedCallback","Schema","NumberValue","min","validate","error","slotName","linkAttributes","getAttributesFromLinkSlot","host","initialize","interactiveResult","buildInteractiveResult","bindings","engine","options","result","getIndexOfEllipsis","parentsCount","valuesToHide","Math","max","valuesToShowBeforeEllipsis","renderEllipsis","h","i18n","t","onClick","e","stopPropagation","focusOnNextTarget","renderSeparator","allParents","parentsXml","parseXML","raw","parents","Array","from","getElementsByTagName","ellipsisIndex","length","map","parent","i","name","getAttribute","uri","renderLink","class","icon","Arrow","role","renderParents","slice","content","shouldSetTarget","LinkWithResultAnalytics","href","title","undefined","onSelect","select","onBeginDelayedSelect","beginDelayedSelect","onCancelPendingSelect","cancelPendingSelect","attributes","ref","el","setTarget","render","field","clickUri","__decorate","InitializeBindings","ResultContext"],"sources":["src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.pcss?tag=atomic-result-printable-uri","src/components/search/result-template-components/atomic-result-printable-uri/atomic-result-printable-uri.tsx"],"sourcesContent":["atomic-result-printable-uri {\n  max-width: 100%;\n  word-break: break-word;\n\n  a,\n  button {\n    color: var(--atomic-primary);\n\n    &:hover,\n    &:focus-visible {\n      text-decoration: underline;\n      color: var(--atomic-primary);\n    }\n\n    &:focus {\n      outline: none;\n    }\n\n    &:visited {\n      color: var(--atomic-visited);\n    }\n  }\n\n  ul {\n    display: flex;\n    flex-wrap: wrap;\n  }\n\n  li {\n    display: inline-flex;\n    align-items: center;\n    max-width: 100%;\n\n    a {\n      display: inline-block;\n      vertical-align: middle;\n      max-width: 100%;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n\n    white-space: nowrap;\n    &:last-child {\n      white-space: normal;\n\n      &::after {\n        content: none;\n      }\n    }\n\n    .result-printable-uri-separator {\n      display: inline-block;\n      margin: 0 0.5rem;\n      vertical-align: middle;\n      width: 0.75rem;\n      height: 0.75rem;\n      color: var(--atomic-neutral-dark);\n    }\n  }\n}\n","import {Schema, NumberValue} from '@coveo/bueno';\nimport {\n  buildInteractiveResult,\n  InteractiveResult,\n  Result,\n} from '@coveo/headless';\nimport {Component, Element, h, Prop, State, VNode} from '@stencil/core';\nimport Arrow from '../../../../images/arrow-right.svg';\nimport {FocusTargetController} from '../../../../utils/accessibility-utils';\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\nimport {parseXML} from '../../../../utils/utils';\nimport {getAttributesFromLinkSlot} from '../../../common/result-link/attributes-slot';\nimport {LinkWithResultAnalytics} from '../../../common/result-link/result-link';\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\nimport {ResultContext} from '../result-template-decorators';\n\n/**\n * The `atomic-result-printable-uri` component displays the URI, or path, to access a result.\n *\n * @slot attributes - Lets you pass [attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attributes) down to anchor elements, overriding other attributes.\n * To be used exclusively in anchor elements, such as: `<a slot=\"attributes\" target=\"_blank\" download></a>`.\n */\n@Component({\n  tag: 'atomic-result-printable-uri',\n  styleUrl: 'atomic-result-printable-uri.pcss',\n  shadow: false,\n})\nexport class AtomicResultPrintableUri {\n  @InitializeBindings() public bindings!: Bindings;\n  @ResultContext() private result!: Result;\n  @Element() public host!: HTMLElement;\n\n  @State() listExpanded = false;\n  @State() error!: Error;\n\n  /**\n   * The maximum number of Uri parts to display. This has to be over the minimum of `3` in order to be effective. Putting `Infinity` will disable the ellipsis.\n   */\n  @Prop({reflect: true}) maxNumberOfParts = 5;\n\n  private expandedPartFocus?: FocusTargetController;\n\n  private interactiveResult!: InteractiveResult;\n  private linkAttributes?: Attr[];\n\n  private get focusTarget() {\n    if (!this.expandedPartFocus) {\n      this.expandedPartFocus = new FocusTargetController(this);\n    }\n    return this.expandedPartFocus;\n  }\n\n  public connectedCallback() {\n    try {\n      new Schema({\n        maxNumberOfParts: new NumberValue({min: 3}),\n      }).validate({maxNumberOfParts: this.maxNumberOfParts});\n    } catch (error) {\n      this.error = error as Error;\n    }\n    const slotName = 'attributes';\n    this.linkAttributes = getAttributesFromLinkSlot(this.host, slotName);\n  }\n\n  public initialize() {\n    this.interactiveResult = buildInteractiveResult(this.bindings.engine, {\n      options: {result: this.result},\n    });\n  }\n\n  private getIndexOfEllipsis(parentsCount: number) {\n    const valuesToHide = Math.max(2, parentsCount - this.maxNumberOfParts);\n    const valuesToShowBeforeEllipsis = parentsCount - valuesToHide - 1;\n    return valuesToShowBeforeEllipsis;\n  }\n\n  private renderEllipsis() {\n    return (\n      <li>\n        <button\n          aria-label={this.bindings.i18n.t('collapsed-uri-parts')}\n          onClick={(e) => {\n            e.stopPropagation();\n            this.focusTarget.focusOnNextTarget();\n            this.listExpanded = true;\n          }}\n        >\n          ...\n        </button>\n        {this.renderSeparator()}\n      </li>\n    );\n  }\n\n  private get allParents() {\n    const parentsXml = parseXML(`${this.result.raw.parents}`);\n    const parents = Array.from(parentsXml.getElementsByTagName('parent'));\n    const ellipsisIndex = this.getIndexOfEllipsis(parents.length);\n    return parents.map((parent, i) => {\n      const name = parent.getAttribute('name');\n      const uri = parent.getAttribute('uri')!;\n      return (\n        <li>\n          {this.renderLink(name, uri, i === ellipsisIndex)}\n          {i === parents.length - 1 ? null : this.renderSeparator()}\n        </li>\n      );\n    });\n  }\n\n  private renderSeparator() {\n    return (\n      <atomic-icon\n        class=\"result-printable-uri-separator\"\n        icon={Arrow}\n        role=\"separator\"\n      ></atomic-icon>\n    );\n  }\n\n  private renderParents() {\n    const parents = this.allParents;\n    if (this.listExpanded || parents.length <= this.maxNumberOfParts) {\n      return parents;\n    }\n\n    return [\n      parents.slice(0, this.getIndexOfEllipsis(parents.length)),\n      this.renderEllipsis(),\n      parents.slice(-1),\n    ];\n  }\n\n  private renderLink(\n    content: VNode | string | null,\n    uri: string,\n    shouldSetTarget: boolean\n  ) {\n    return (\n      <LinkWithResultAnalytics\n        href={uri}\n        title={typeof content === 'string' ? content : undefined}\n        onSelect={() => this.interactiveResult.select()}\n        onBeginDelayedSelect={() => this.interactiveResult.beginDelayedSelect()}\n        onCancelPendingSelect={() =>\n          this.interactiveResult.cancelPendingSelect()\n        }\n        attributes={this.linkAttributes}\n        ref={\n          shouldSetTarget\n            ? (el?: HTMLAnchorElement) => this.focusTarget.setTarget(el)\n            : undefined\n        }\n      >\n        {content}\n      </LinkWithResultAnalytics>\n    );\n  }\n\n  public render() {\n    const parents = this.renderParents();\n    if (parents.length) {\n      return (\n        <ul aria-label={this.bindings.i18n.t('printable-uri')}>{parents}</ul>\n      );\n    }\n\n    return this.renderLink(\n      <atomic-result-text field=\"printableUri\"></atomic-result-text>,\n      this.result.clickUri,\n      false\n    );\n  }\n}\n"],"mappings":"qcAAA,MAAMA,EAA8B,kkD,iXC2BvBC,EAAwB,M,yBAK1BC,KAAAC,aAAe,MAMDD,KAAAE,iBAAmB,E,kBANlB,M,2CAMkB,C,CAO1C,eAAYC,GACV,IAAKH,KAAKI,kBAAmB,CAC3BJ,KAAKI,kBAAoB,IAAIC,EAAsBL,K,CAErD,OAAOA,KAAKI,iB,CAGP,iBAAAE,GACL,IACE,IAAIC,EAAO,CACTL,iBAAkB,IAAIM,EAAY,CAACC,IAAK,MACvCC,SAAS,CAACR,iBAAkBF,KAAKE,kB,CACpC,MAAOS,GACPX,KAAKW,MAAQA,C,CAEf,MAAMC,EAAW,aACjBZ,KAAKa,eAAiBC,EAA0Bd,KAAKe,KAAMH,E,CAGtD,UAAAI,GACLhB,KAAKiB,kBAAoBC,EAAuBlB,KAAKmB,SAASC,OAAQ,CACpEC,QAAS,CAACC,OAAQtB,KAAKsB,S,CAInB,kBAAAC,CAAmBC,GACzB,MAAMC,EAAeC,KAAKC,IAAI,EAAGH,EAAexB,KAAKE,kBACrD,MAAM0B,EAA6BJ,EAAeC,EAAe,EACjE,OAAOG,C,CAGD,cAAAC,GACN,OACEC,EAAA,UACEA,EAAA,uBACc9B,KAAKmB,SAASY,KAAKC,EAAE,uBACjCC,QAAUC,IACRA,EAAEC,kBACFnC,KAAKG,YAAYiC,oBACjBpC,KAAKC,aAAe,IAAI,GACzB,OAIFD,KAAKqC,kB,CAKZ,cAAYC,GACV,MAAMC,EAAaC,EAAS,GAAGxC,KAAKsB,OAAOmB,IAAIC,WAC/C,MAAMA,EAAUC,MAAMC,KAAKL,EAAWM,qBAAqB,WAC3D,MAAMC,EAAgB9C,KAAKuB,mBAAmBmB,EAAQK,QACtD,OAAOL,EAAQM,KAAI,CAACC,EAAQC,KAC1B,MAAMC,EAAOF,EAAOG,aAAa,QACjC,MAAMC,EAAMJ,EAAOG,aAAa,OAChC,OACEtB,EAAA,UACG9B,KAAKsD,WAAWH,EAAME,EAAKH,IAAMJ,GACjCI,IAAMR,EAAQK,OAAS,EAAI,KAAO/C,KAAKqC,kBACrC,G,CAKH,eAAAA,GACN,OACEP,EAAA,eACEyB,MAAM,iCACNC,KAAMC,EACNC,KAAK,a,CAKH,aAAAC,GACN,MAAMjB,EAAU1C,KAAKsC,WACrB,GAAItC,KAAKC,cAAgByC,EAAQK,QAAU/C,KAAKE,iBAAkB,CAChE,OAAOwC,C,CAGT,MAAO,CACLA,EAAQkB,MAAM,EAAG5D,KAAKuB,mBAAmBmB,EAAQK,SACjD/C,KAAK6B,iBACLa,EAAQkB,OAAO,G,CAIX,UAAAN,CACNO,EACAR,EACAS,GAEA,OACEhC,EAACiC,EAAuB,CACtBC,KAAMX,EACNY,aAAcJ,IAAY,SAAWA,EAAUK,UAC/CC,SAAU,IAAMnE,KAAKiB,kBAAkBmD,SACvCC,qBAAsB,IAAMrE,KAAKiB,kBAAkBqD,qBACnDC,sBAAuB,IACrBvE,KAAKiB,kBAAkBuD,sBAEzBC,WAAYzE,KAAKa,eACjB6D,IACEZ,EACKa,GAA2B3E,KAAKG,YAAYyE,UAAUD,GACvDT,WAGLL,E,CAKA,MAAAgB,GACL,MAAMnC,EAAU1C,KAAK2D,gBACrB,GAAIjB,EAAQK,OAAQ,CAClB,OACEjB,EAAA,mBAAgB9B,KAAKmB,SAASY,KAAKC,EAAE,kBAAmBU,E,CAI5D,OAAO1C,KAAKsD,WACVxB,EAAA,sBAAoBgD,MAAM,iBAC1B9E,KAAKsB,OAAOyD,SACZ,M,6BA9IyBC,EAAA,CAA5BC,K,+BACwBD,EAAA,CAAxBE,K"}